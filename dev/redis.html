<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis | Hot</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="安全开发工程师(打杂工程师)的学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.c319bac8.js" as="script"><link rel="preload" href="/assets/js/2.ee734a59.js" as="script"><link rel="preload" href="/assets/js/106.f9a27c7b.js" as="script"><link rel="prefetch" href="/assets/js/10.9841cdef.js"><link rel="prefetch" href="/assets/js/100.98c51b8e.js"><link rel="prefetch" href="/assets/js/101.80ca1839.js"><link rel="prefetch" href="/assets/js/102.1c33cf56.js"><link rel="prefetch" href="/assets/js/103.b0b93725.js"><link rel="prefetch" href="/assets/js/104.c0c62484.js"><link rel="prefetch" href="/assets/js/105.1134daba.js"><link rel="prefetch" href="/assets/js/107.d3560c2c.js"><link rel="prefetch" href="/assets/js/108.dc824726.js"><link rel="prefetch" href="/assets/js/109.56b97cf6.js"><link rel="prefetch" href="/assets/js/11.8bb5db91.js"><link rel="prefetch" href="/assets/js/110.9893b030.js"><link rel="prefetch" href="/assets/js/111.53623519.js"><link rel="prefetch" href="/assets/js/112.e5269575.js"><link rel="prefetch" href="/assets/js/113.2a3d6326.js"><link rel="prefetch" href="/assets/js/114.f28d91ec.js"><link rel="prefetch" href="/assets/js/115.4219f56e.js"><link rel="prefetch" href="/assets/js/116.2f15c358.js"><link rel="prefetch" href="/assets/js/117.7e79e8c3.js"><link rel="prefetch" href="/assets/js/118.cd0ccb4e.js"><link rel="prefetch" href="/assets/js/119.1a8f3bb4.js"><link rel="prefetch" href="/assets/js/12.c3457dbf.js"><link rel="prefetch" href="/assets/js/120.22b3dd05.js"><link rel="prefetch" href="/assets/js/121.48115499.js"><link rel="prefetch" href="/assets/js/122.49df4874.js"><link rel="prefetch" href="/assets/js/123.bb366ac5.js"><link rel="prefetch" href="/assets/js/124.a1091dce.js"><link rel="prefetch" href="/assets/js/125.cba9e1c7.js"><link rel="prefetch" href="/assets/js/126.5632c4d7.js"><link rel="prefetch" href="/assets/js/127.83f20d12.js"><link rel="prefetch" href="/assets/js/128.df2f79c7.js"><link rel="prefetch" href="/assets/js/129.714ec10b.js"><link rel="prefetch" href="/assets/js/13.5a5564aa.js"><link rel="prefetch" href="/assets/js/130.f648ae53.js"><link rel="prefetch" href="/assets/js/14.31b1fb86.js"><link rel="prefetch" href="/assets/js/15.1f1a4999.js"><link rel="prefetch" href="/assets/js/16.2445c170.js"><link rel="prefetch" href="/assets/js/17.00149ca9.js"><link rel="prefetch" href="/assets/js/18.14f17999.js"><link rel="prefetch" href="/assets/js/19.4dfbf270.js"><link rel="prefetch" href="/assets/js/20.4f419716.js"><link rel="prefetch" href="/assets/js/21.04f10048.js"><link rel="prefetch" href="/assets/js/22.d5ea4ea8.js"><link rel="prefetch" href="/assets/js/23.2da0cb4d.js"><link rel="prefetch" href="/assets/js/24.171bad48.js"><link rel="prefetch" href="/assets/js/25.c648bffe.js"><link rel="prefetch" href="/assets/js/26.f7412ad6.js"><link rel="prefetch" href="/assets/js/27.3358de23.js"><link rel="prefetch" href="/assets/js/28.f4a4badf.js"><link rel="prefetch" href="/assets/js/29.5581c8fb.js"><link rel="prefetch" href="/assets/js/3.208249f8.js"><link rel="prefetch" href="/assets/js/30.4f07acfb.js"><link rel="prefetch" href="/assets/js/31.ad87b1d0.js"><link rel="prefetch" href="/assets/js/32.218c7530.js"><link rel="prefetch" href="/assets/js/33.06ce8d5f.js"><link rel="prefetch" href="/assets/js/34.e645d5f9.js"><link rel="prefetch" href="/assets/js/35.d3c03632.js"><link rel="prefetch" href="/assets/js/36.3b7139b6.js"><link rel="prefetch" href="/assets/js/37.9d30b16f.js"><link rel="prefetch" href="/assets/js/38.37e19265.js"><link rel="prefetch" href="/assets/js/39.a7a5a417.js"><link rel="prefetch" href="/assets/js/4.2ecfd9d7.js"><link rel="prefetch" href="/assets/js/40.8bd9d455.js"><link rel="prefetch" href="/assets/js/41.6a059dcc.js"><link rel="prefetch" href="/assets/js/42.e2361cae.js"><link rel="prefetch" href="/assets/js/43.7101e1e6.js"><link rel="prefetch" href="/assets/js/44.d8df0a7a.js"><link rel="prefetch" href="/assets/js/45.7b4583e6.js"><link rel="prefetch" href="/assets/js/46.6cf5ac92.js"><link rel="prefetch" href="/assets/js/47.ffd093f8.js"><link rel="prefetch" href="/assets/js/48.f69288ff.js"><link rel="prefetch" href="/assets/js/49.006a40a0.js"><link rel="prefetch" href="/assets/js/5.20014036.js"><link rel="prefetch" href="/assets/js/50.2a75a383.js"><link rel="prefetch" href="/assets/js/51.192e7cb9.js"><link rel="prefetch" href="/assets/js/52.cc5ea856.js"><link rel="prefetch" href="/assets/js/53.b963fae3.js"><link rel="prefetch" href="/assets/js/54.1e75d52b.js"><link rel="prefetch" href="/assets/js/55.aaf95197.js"><link rel="prefetch" href="/assets/js/56.b57fb18c.js"><link rel="prefetch" href="/assets/js/57.d6ec3a28.js"><link rel="prefetch" href="/assets/js/58.a59a2bb3.js"><link rel="prefetch" href="/assets/js/59.2fd766d2.js"><link rel="prefetch" href="/assets/js/6.1aac11ee.js"><link rel="prefetch" href="/assets/js/60.9e6636d0.js"><link rel="prefetch" href="/assets/js/61.83fb732b.js"><link rel="prefetch" href="/assets/js/62.4ade8f03.js"><link rel="prefetch" href="/assets/js/63.bc5bd52e.js"><link rel="prefetch" href="/assets/js/64.0ee3dd03.js"><link rel="prefetch" href="/assets/js/65.ef7b2f39.js"><link rel="prefetch" href="/assets/js/66.c4321bd0.js"><link rel="prefetch" href="/assets/js/67.d0758688.js"><link rel="prefetch" href="/assets/js/68.014193b5.js"><link rel="prefetch" href="/assets/js/69.a6114edb.js"><link rel="prefetch" href="/assets/js/7.1848bf21.js"><link rel="prefetch" href="/assets/js/70.e685c54f.js"><link rel="prefetch" href="/assets/js/71.504c2b6b.js"><link rel="prefetch" href="/assets/js/72.4c7505ad.js"><link rel="prefetch" href="/assets/js/73.6790e908.js"><link rel="prefetch" href="/assets/js/74.71d69108.js"><link rel="prefetch" href="/assets/js/75.72af672f.js"><link rel="prefetch" href="/assets/js/76.c4a9226c.js"><link rel="prefetch" href="/assets/js/77.d38a498d.js"><link rel="prefetch" href="/assets/js/78.871d750a.js"><link rel="prefetch" href="/assets/js/79.527e7a49.js"><link rel="prefetch" href="/assets/js/8.8534ef4e.js"><link rel="prefetch" href="/assets/js/80.715f442a.js"><link rel="prefetch" href="/assets/js/81.74a2b8bd.js"><link rel="prefetch" href="/assets/js/82.066897b9.js"><link rel="prefetch" href="/assets/js/83.c264466b.js"><link rel="prefetch" href="/assets/js/84.18734103.js"><link rel="prefetch" href="/assets/js/85.afd2f665.js"><link rel="prefetch" href="/assets/js/86.073fdd24.js"><link rel="prefetch" href="/assets/js/87.29303003.js"><link rel="prefetch" href="/assets/js/88.d3d4f30c.js"><link rel="prefetch" href="/assets/js/89.56c3e387.js"><link rel="prefetch" href="/assets/js/9.73e739d0.js"><link rel="prefetch" href="/assets/js/90.022513aa.js"><link rel="prefetch" href="/assets/js/91.3cece5cd.js"><link rel="prefetch" href="/assets/js/92.1f9fa6f9.js"><link rel="prefetch" href="/assets/js/93.35733127.js"><link rel="prefetch" href="/assets/js/94.71526dfb.js"><link rel="prefetch" href="/assets/js/95.eff5cd3e.js"><link rel="prefetch" href="/assets/js/96.a30824e0.js"><link rel="prefetch" href="/assets/js/97.1e11427f.js"><link rel="prefetch" href="/assets/js/98.522292bb.js"><link rel="prefetch" href="/assets/js/99.6bf29dfd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hot</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sec/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/ops/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zmf963/showip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  show ip
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/subdomain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  subdomain
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/hotfinger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hotfinger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/HotSec" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sec/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/ops/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zmf963/showip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  show ip
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/subdomain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  subdomain
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/hotfinger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hotfinger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/HotSec" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> redis</h1> <ol><li>为什么要用缓存 （内存缓存）
<ol><li>缓解关系型数据库并发访问压力：热点数据</li> <li>减少响应时间：内存IO速度比磁盘快</li> <li>提升吞吐量：Redis等内存数据库单机就可以支持很大并发</li></ol></li> <li>redis和memcached主要区别
<ol><li>整体类型
<ol><li>r 支持内存 非关系型数据库</li> <li>m 支持内存  key-value</li></ol></li> <li>数据类型
<ol><li>r  string list set zset hash</li> <li>m  文本型 二进制类型</li></ol></li> <li>操作类型
<ol><li>r  单个操作、批量操作、事务支持（弱事务、结合lua)、每个类型不同的curd</li> <li>m  curd 少量其它命令</li></ol></li> <li>附加功能
<ol><li>r 发布\订阅、主从高可用（哨兵、故障转移）、序列化支持、支持lua脚本</li> <li>m 多线程服务支持</li></ol></li> <li>网络IO模型
<ol><li>r 执行命令-单线程、网络操作-多线程</li> <li>m 多线程、非阻塞的IO模式</li></ol></li> <li>持久化
<ol><li>r RDB、AOF</li> <li>m 不支持</li></ol></li></ol></li> <li>redis常用数据类型与使用场景
<ol><li>string: 用来实现简单的kv键值对存储，比如计数器</li> <li>list：实现双向链表，比如用户的关注，粉丝列表</li> <li>hash：用来存储彼此相关信息的键值对</li> <li>set：存储不重复元素，比如用户的关注者</li> <li>sorted set: 实时信息排行榜</li></ol></li> <li>redis各种内置类型的实现方式
<ol><li>string: 整数或者sds (simple dynamic string)</li> <li>list: ziplist或者double linked list</li> <li>hash: ziplist或者hashtable</li> <li>set：intset或者hashtable</li> <li>sortedset：skiplist跳跃表</li></ol></li> <li>redis持久化
<ol><li>快照方式：把数据快照放在磁盘二进制文件中，dump.rdb</li> <li>AOF(Append Only File): 每一个写命令追加到appendonly.aof中</li> <li>可以通过修改redis配置实现</li></ol></li> <li>redis&quot;事务&quot;
<ol><li>将多个请求打包，一次性、按顺序执行多个命令的机制</li> <li>通过multi,exec,watch等命令实现事务功能
<ol><li>multi 命令开始</li> <li>要执行的一组命令</li> <li>exec 命令结束</li></ol></li> <li>redis-py pipeline=conn.pipeline(transaction=True)</li> <li>redis的事务功能很弱，在事务回滚机制上，只能进行基本的语法错误判断。事务不支持回滚</li> <li>原理：服务端的行为，用户执行multi命令时，服务器会将命令缓存起来，直到用户执行exec,才按顺序执行命令</li></ol></li> <li>redis如何实现分布式锁？
<ol><li>使用setnx实现加锁，可以同时通过expire添加超时时间</li> <li>锁的value值可以使用一个随机的uuid或者特定的命名</li> <li>释放锁的时候，通过uuid判断是否是该锁，是则执行delete释放锁</li></ol></li> <li>使用缓存的模式？
<ol><li>Cache Aside: 同时更新缓存和数据库</li> <li>Read/Write Through: 先更新缓存，缓存负责同步更新数据库</li> <li>Write Behind Caching: 先更新缓存，缓存定期异步更新数据库</li></ol></li> <li>如何解决缓存穿透问题？
<ol><li>原因：
<ol><li>大量查询不到的数据请求落到后端数据库，数据库压力增大</li> <li>由于大量缓存查不到就去数据库取，数据库也没有要查的数据</li></ol></li> <li>解决：</li> <li>对于没有查询到返回为None的数据也缓存</li> <li>插入数据的时候删除相应缓存，或者设置较短的超时时间</li> <li>布隆过滤器与Bitmaps
<ol><li>用来判断一个元素是否在一个集合中</li> <li>由一个二进制数组和一个hash算法组成</li> <li>误判问题
<ol><li>本质hash冲突</li> <li>通过hash计算在数组上不一定在集合</li> <li><strong>通过hash计算不在数组的一定不在集合</strong> <ol><li>优化方案</li> <li>增大数组</li> <li>增加hash函数</li></ol></li></ol></li></ol></li></ol></li> <li>如何解决缓存击穿问题？
<ol><li>某些非常热点的数据key过期，大量请求打到后端数据库</li> <li>热点数据key失效导致大量请求打到数据库增加数据库压力</li> <li>分布式锁：获取锁的线程从数据库拉数据更新缓存，其他线程等待</li> <li>异步后台更新：后台任务针对过期的key自动刷新</li></ol></li> <li>如何解决缓存雪崩问题？
<ol><li>缓存不可用 redis挂了 -&gt; 解决：集群</li> <li>大量缓存key同时失效，大量请求直接打到数据库
<ol><li>多级缓存：不同级别的key设置不同的超时时间</li> <li>随机超时：key的超时时间随机设置，防止同时超时</li> <li>架构层：提升系统可用性。监控、报警完善</li></ol></li></ol></li> <li>redis6.0前为什么单线程
<ol><li>cpu不是瓶颈，主要受限内存、网络</li> <li>pipeline （命令批量）每秒100w个请求</li> <li>单线程的内部开发维护成本低</li> <li>如果是多线程，会涉及到线程切换、加锁\解锁、导致死锁问题</li> <li>惰性Rehash(渐进性式的Rehash)</li> <li>一般的情况，单线程redis就够用了</li></ol></li> <li>redis为什么快
<ol><li>纯内存操作</li> <li>单线程避免上下文切换</li> <li>渐进式rehash、缓存时间戳</li></ol></li> <li>redis6.0为什么引入多线程
<ol><li>单线程就够了。数据-&gt;内存 响应时间 100ns
<ol><li>比较小的数据包，8w~10w qsp（极限值）</li></ol></li> <li>大的公司，需要更大的QPS，IO的多线程（内部执行命令还是单线程）</li> <li>为什么不采用分布式架构----很大的缺点
<ol><li>服务数量多，维护成本很高</li> <li>redis命令，不适用数据分区</li> <li>数据倾斜，重新分配、扩容、缩容，更加复杂</li></ol></li> <li>多线程任务 分摊到Redis同步IO中读写 负载</li></ol></li> <li>Redis有哪些高级功能
<ol><li>Redis的慢查询
<ol><li>快速定位系统存在的慢操作</li></ol></li> <li>pipeline
<ol><li>管道 批量操作</li></ol></li> <li>事务</li> <li>Lua</li> <li>持久化
<ol><li>rdb</li> <li>aof</li></ol></li> <li>缓存策略</li></ol></li> <li>主重复制</li> <li>高可用集群搭建</li> <li>为什么要用redis
<ol><li>高性能</li> <li>高并发</li></ol></li> <li>reids的过期策略和淘汰策略
<ol><li>定期删除
<ol><li>从库是从主库同步的</li></ol></li> <li>惰性删除
<ol><li>客户端访问这个key的时候，检查过期时间，过期了就立即删除，不返回任何东西</li></ol></li> <li>缓存淘汰算法
<ol><li>maxmemory</li> <li>volatile-lru</li> <li>volatile-ttl</li> <li>volatile-random</li> <li>allkeys-lru</li> <li>allkeys-random</li></ol></li></ol></li> <li>LRU算法
<ol><li>维护一个链表，元素按照一定顺序进行排列，满了就会删除尾部的元素，当元素被访问时，元素在链表的位置就会被移动到表头，元素排列的顺序就元素最近被访问的时间顺序</li> <li>redis的近似lru算法</li> <li>不使用lru算法是因为需要消耗大量的额外内存，需要对现有的数据结构进行较大的改造</li> <li>在现有数据结构的基础上使用随机采样法来淘汰元素，给每个key添加一个额外字段24bit，记录最后一次被访问的时间戳，redis执行写操作时，发现内存超过maxmemory，就会执行lru淘汰算法，随机采用出5个（maxmemory-sample)key，然后淘汰到最旧的key。</li></ol></li> <li>redis中消息队列实现方式
<ol><li>基于List的LPUSH+BRPOP的实现
<ol><li>足够简单，消息延迟几乎为零，但是需要处理空闲连接的问题</li> <li>如果线程一直阻塞，redis客户端的连接就成了闲置连接，长时间闲置，服务器一般会主动断开连接，减少闲置资源占用， blpop/brpop会抛出异常</li> <li>消费者做ack麻烦，不能保证消费者消费消息后是否处理成功的问题，通常需要维护一个pending列表，保证消息处理确认</li> <li>不能做广播模式，如pub/sub,消息发布/订阅模型;不能重复消费，一旦消费就会被删除;不支持分组消费</li></ol></li> <li>基于Sorted-Set的实现
<ol><li>多用来实现延迟队列，（当然也可以实现有序的普通的消息队列），消费者无法阻塞的获取消息，只能轮询，不允许重复消息</li></ol></li> <li>PUB/SUB，发布/订阅模式
<ol><li>典型的广播模式，一个消息可以发布到多个消费者;</li> <li>多信道订阅，消费者可以同时订阅多个信道消息</li> <li>消息即时发送，消息不用等待消费者读取，消费者会自动接收到信道发布的消息</li> <li>缺点：
<ol><li>消息一旦发布，不能接收，发布时若客户端不在线，则消息丢失</li> <li>不保证每个消费者接收的时间是一致的；若消费者客户端出现消息积压，到一定程度，会被强制断开，导致消息意外丢失。通常发生在消息的生产远大于消费速度时。</li></ol></li> <li>Pub/Sub模式不适合做消息存储，消息挤压类的业务，而是擅长处理广播，即时通讯，即时反馈的业务。</li></ol></li> <li>基于stream类型的实现
<ol><li>redis5.0新增的支持多播的可持久化的消息队列
<ol><li>生产者API、消费者API、消息Broker,消息的确认机制等等</li></ol></li> <li>消息太多怎么办
<ol><li>定长Stream功能。xadd指令提供一个定长长度maxlen，就可以将老的消息干掉，确保最多不超过指定长度</li></ol></li> <li>消息如果忘记ACK
<ol><li>在每个消费者结构中保存了正在处理中的消息ID列表PEL，如果消费者收了消息但是没有回复ack,就会导致PEL列表不断增长。</li></ol></li> <li>PEL如何避免消息丢失
<ol><li>断开重连后，xreadgroup的起始消息ID 0-0,表示读取所有的PEL消息以及自last_delivered_id之后的新消息</li></ol></li> <li>死信问题
<ol><li>消息老是消费不掉 XPENDING可以查询到</li> <li>XDEL删除掉一个消息，XACK将这个消息标记为处理完毕</li></ol></li> <li>stream高可用
<ol><li>建立在主从复制的基础上，跟其它结构没区别</li> <li>failover发生时，可能会丢极小部分数据</li></ol></li> <li>分区partiotion
<ol><li>没有原生支持分区能力</li> <li>可以分配多个stream,然后在客户端生成消息时用不同的策略发送到不同stream</li></ol></li></ol></li></ol></li> <li>什么是bigkey？会有什么影响？
<ol><li>key对应的value所在的内存空间比较大
<ol><li>字符串 最大512m</li> <li>列表 value最多存储2^32-1个元素</li></ol></li> <li>危害
<ol><li>内存空间不平衡</li> <li>超时阻塞</li> <li>网络拥塞</li> <li>bigkey的存在并不是完全致命的，主要还是看是否会被频繁访问</li></ol></li></ol></li> <li>redis如何解决key冲突
<ol><li>业务隔离</li> <li>key的设计
<ol><li>业务模块+系统名称+关键 biz-pay-orderid-1, userid</li></ol></li> <li>分布式锁
<ol><li>多个客户端，并发写key</li></ol></li></ol></li> <li>如何提高缓存命中率？
<ol><li>提前加载</li> <li>增加缓存的存储空间，提高缓存的数据量、提高命中率</li> <li>调整缓存的存储类型？</li> <li>提升缓存的更新频次</li></ol></li> <li>持久化
<ol><li>RDB  Redis DataBase
<ol><li>生成快照保存到硬盘</li> <li>save</li> <li>bgsave</li> <li><code>dbfilename dump-${port}.rdb</code></li> <li><code>dir ./</code></li></ol></li> <li>AOF append only file
<ol><li>以独立日志的方式记录每次写命令，重启时再重新执行AOF文件中的命令达到恢复数据的目的，主要是解决实时性的问题，性能没有rdb高</li> <li><code>appendonly yes</code> 默认开启</li> <li><code>appendfilename &quot;appendonly.aof</code></li> <li><code>appendfsync: no/always/everysec</code> 不执行/每次写入都执行/每秒执行一次</li> <li><code>redis-check-aof --fix</code>命令来修复破损的AOF文件</li></ol></li> <li>RDB-AOF混合持久化
<ol><li>同时启用AOF和RDB</li></ol></li></ol></li> <li>为什么redis需要把所有的数据放到内存中？
<ol><li>内存读写速度快</li></ol></li> <li>如何保证缓存与数据库双写时的数据一致性?</li> <li>redis集群方案应该怎么做?</li> <li>redis集群方案什么情况下会导致集群不可用</li> <li>redis哈希槽的概念</li> <li>redis集群写操作会有丢失吗？为什么</li> <li>redis常见性能问题和解决方案有哪些?</li> <li>热点数据和冷数据是什么?</li> <li>什么情况下可能会导致redis阻塞
<ol><li>客户端 阻塞 命令 keys* Hgetall smembers 时间复杂度 O(N)</li> <li>BIGkey删除 zset (100万的元素 删除2s)</li> <li>清空库 flushdb flushall</li> <li>AOF日志同步写， 记录AOF日志 大量的写操作  1个同步写磁盘耗时1-2ms</li> <li>从库 加载RDB文件</li></ol></li> <li>什么时候选择redis，什么时候选择memcached
<ol><li>redis功能更加强大 kv模式 string/list/hash/set/zset  memcache kv简单存储</li> <li>redis有持久化 memcache 不支持持久化</li> <li>内存管理：
<ol><li>r 过期、内存淘汰策略</li> <li>m 预分配池的管理，内存slab块 增长因子</li> <li>redis适合做数据存储，memcache缓存</li></ol></li> <li>io角度
<ol><li>多路复用io   命令 单线程， 子命令 锁冲突</li> <li>非阻塞的IO多路复用</li></ol></li></ol></li> <li>redis过期策略都有哪些？LRU算法</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/4/2024, 10:16:52 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c319bac8.js" defer></script><script src="/assets/js/2.ee734a59.js" defer></script><script src="/assets/js/106.f9a27c7b.js" defer></script>
  </body>
</html>
