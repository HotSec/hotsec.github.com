<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes | Hot</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="安全开发工程师(打杂工程师)的学习笔记">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.c319bac8.js" as="script"><link rel="preload" href="/assets/js/2.ee734a59.js" as="script"><link rel="preload" href="/assets/js/92.1f9fa6f9.js" as="script"><link rel="prefetch" href="/assets/js/10.9841cdef.js"><link rel="prefetch" href="/assets/js/100.98c51b8e.js"><link rel="prefetch" href="/assets/js/101.80ca1839.js"><link rel="prefetch" href="/assets/js/102.1c33cf56.js"><link rel="prefetch" href="/assets/js/103.b0b93725.js"><link rel="prefetch" href="/assets/js/104.c0c62484.js"><link rel="prefetch" href="/assets/js/105.1134daba.js"><link rel="prefetch" href="/assets/js/106.f9a27c7b.js"><link rel="prefetch" href="/assets/js/107.d3560c2c.js"><link rel="prefetch" href="/assets/js/108.dc824726.js"><link rel="prefetch" href="/assets/js/109.56b97cf6.js"><link rel="prefetch" href="/assets/js/11.8bb5db91.js"><link rel="prefetch" href="/assets/js/110.9893b030.js"><link rel="prefetch" href="/assets/js/111.53623519.js"><link rel="prefetch" href="/assets/js/112.e5269575.js"><link rel="prefetch" href="/assets/js/113.2a3d6326.js"><link rel="prefetch" href="/assets/js/114.f28d91ec.js"><link rel="prefetch" href="/assets/js/115.4219f56e.js"><link rel="prefetch" href="/assets/js/116.2f15c358.js"><link rel="prefetch" href="/assets/js/117.7e79e8c3.js"><link rel="prefetch" href="/assets/js/118.cd0ccb4e.js"><link rel="prefetch" href="/assets/js/119.1a8f3bb4.js"><link rel="prefetch" href="/assets/js/12.c3457dbf.js"><link rel="prefetch" href="/assets/js/120.22b3dd05.js"><link rel="prefetch" href="/assets/js/121.48115499.js"><link rel="prefetch" href="/assets/js/122.49df4874.js"><link rel="prefetch" href="/assets/js/123.bb366ac5.js"><link rel="prefetch" href="/assets/js/124.a1091dce.js"><link rel="prefetch" href="/assets/js/125.cba9e1c7.js"><link rel="prefetch" href="/assets/js/126.5632c4d7.js"><link rel="prefetch" href="/assets/js/127.83f20d12.js"><link rel="prefetch" href="/assets/js/128.df2f79c7.js"><link rel="prefetch" href="/assets/js/129.714ec10b.js"><link rel="prefetch" href="/assets/js/13.5a5564aa.js"><link rel="prefetch" href="/assets/js/130.f648ae53.js"><link rel="prefetch" href="/assets/js/14.31b1fb86.js"><link rel="prefetch" href="/assets/js/15.1f1a4999.js"><link rel="prefetch" href="/assets/js/16.2445c170.js"><link rel="prefetch" href="/assets/js/17.00149ca9.js"><link rel="prefetch" href="/assets/js/18.14f17999.js"><link rel="prefetch" href="/assets/js/19.4dfbf270.js"><link rel="prefetch" href="/assets/js/20.4f419716.js"><link rel="prefetch" href="/assets/js/21.04f10048.js"><link rel="prefetch" href="/assets/js/22.d5ea4ea8.js"><link rel="prefetch" href="/assets/js/23.2da0cb4d.js"><link rel="prefetch" href="/assets/js/24.171bad48.js"><link rel="prefetch" href="/assets/js/25.c648bffe.js"><link rel="prefetch" href="/assets/js/26.f7412ad6.js"><link rel="prefetch" href="/assets/js/27.3358de23.js"><link rel="prefetch" href="/assets/js/28.f4a4badf.js"><link rel="prefetch" href="/assets/js/29.5581c8fb.js"><link rel="prefetch" href="/assets/js/3.208249f8.js"><link rel="prefetch" href="/assets/js/30.4f07acfb.js"><link rel="prefetch" href="/assets/js/31.ad87b1d0.js"><link rel="prefetch" href="/assets/js/32.218c7530.js"><link rel="prefetch" href="/assets/js/33.06ce8d5f.js"><link rel="prefetch" href="/assets/js/34.e645d5f9.js"><link rel="prefetch" href="/assets/js/35.d3c03632.js"><link rel="prefetch" href="/assets/js/36.3b7139b6.js"><link rel="prefetch" href="/assets/js/37.9d30b16f.js"><link rel="prefetch" href="/assets/js/38.37e19265.js"><link rel="prefetch" href="/assets/js/39.a7a5a417.js"><link rel="prefetch" href="/assets/js/4.2ecfd9d7.js"><link rel="prefetch" href="/assets/js/40.8bd9d455.js"><link rel="prefetch" href="/assets/js/41.6a059dcc.js"><link rel="prefetch" href="/assets/js/42.e2361cae.js"><link rel="prefetch" href="/assets/js/43.7101e1e6.js"><link rel="prefetch" href="/assets/js/44.d8df0a7a.js"><link rel="prefetch" href="/assets/js/45.7b4583e6.js"><link rel="prefetch" href="/assets/js/46.6cf5ac92.js"><link rel="prefetch" href="/assets/js/47.ffd093f8.js"><link rel="prefetch" href="/assets/js/48.f69288ff.js"><link rel="prefetch" href="/assets/js/49.006a40a0.js"><link rel="prefetch" href="/assets/js/5.20014036.js"><link rel="prefetch" href="/assets/js/50.2a75a383.js"><link rel="prefetch" href="/assets/js/51.192e7cb9.js"><link rel="prefetch" href="/assets/js/52.cc5ea856.js"><link rel="prefetch" href="/assets/js/53.b963fae3.js"><link rel="prefetch" href="/assets/js/54.1e75d52b.js"><link rel="prefetch" href="/assets/js/55.aaf95197.js"><link rel="prefetch" href="/assets/js/56.b57fb18c.js"><link rel="prefetch" href="/assets/js/57.d6ec3a28.js"><link rel="prefetch" href="/assets/js/58.a59a2bb3.js"><link rel="prefetch" href="/assets/js/59.2fd766d2.js"><link rel="prefetch" href="/assets/js/6.1aac11ee.js"><link rel="prefetch" href="/assets/js/60.9e6636d0.js"><link rel="prefetch" href="/assets/js/61.83fb732b.js"><link rel="prefetch" href="/assets/js/62.4ade8f03.js"><link rel="prefetch" href="/assets/js/63.bc5bd52e.js"><link rel="prefetch" href="/assets/js/64.0ee3dd03.js"><link rel="prefetch" href="/assets/js/65.ef7b2f39.js"><link rel="prefetch" href="/assets/js/66.c4321bd0.js"><link rel="prefetch" href="/assets/js/67.d0758688.js"><link rel="prefetch" href="/assets/js/68.014193b5.js"><link rel="prefetch" href="/assets/js/69.a6114edb.js"><link rel="prefetch" href="/assets/js/7.1848bf21.js"><link rel="prefetch" href="/assets/js/70.e685c54f.js"><link rel="prefetch" href="/assets/js/71.504c2b6b.js"><link rel="prefetch" href="/assets/js/72.4c7505ad.js"><link rel="prefetch" href="/assets/js/73.6790e908.js"><link rel="prefetch" href="/assets/js/74.71d69108.js"><link rel="prefetch" href="/assets/js/75.72af672f.js"><link rel="prefetch" href="/assets/js/76.c4a9226c.js"><link rel="prefetch" href="/assets/js/77.d38a498d.js"><link rel="prefetch" href="/assets/js/78.871d750a.js"><link rel="prefetch" href="/assets/js/79.527e7a49.js"><link rel="prefetch" href="/assets/js/8.8534ef4e.js"><link rel="prefetch" href="/assets/js/80.715f442a.js"><link rel="prefetch" href="/assets/js/81.74a2b8bd.js"><link rel="prefetch" href="/assets/js/82.066897b9.js"><link rel="prefetch" href="/assets/js/83.c264466b.js"><link rel="prefetch" href="/assets/js/84.18734103.js"><link rel="prefetch" href="/assets/js/85.afd2f665.js"><link rel="prefetch" href="/assets/js/86.073fdd24.js"><link rel="prefetch" href="/assets/js/87.29303003.js"><link rel="prefetch" href="/assets/js/88.d3d4f30c.js"><link rel="prefetch" href="/assets/js/89.56c3e387.js"><link rel="prefetch" href="/assets/js/9.73e739d0.js"><link rel="prefetch" href="/assets/js/90.022513aa.js"><link rel="prefetch" href="/assets/js/91.3cece5cd.js"><link rel="prefetch" href="/assets/js/93.35733127.js"><link rel="prefetch" href="/assets/js/94.71526dfb.js"><link rel="prefetch" href="/assets/js/95.eff5cd3e.js"><link rel="prefetch" href="/assets/js/96.a30824e0.js"><link rel="prefetch" href="/assets/js/97.1e11427f.js"><link rel="prefetch" href="/assets/js/98.522292bb.js"><link rel="prefetch" href="/assets/js/99.6bf29dfd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hot</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sec/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/ops/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zmf963/showip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  show ip
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/subdomain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  subdomain
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/hotfinger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hotfinger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/HotSec" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sec/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  开发
</a></div><div class="nav-item"><a href="/ops/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zmf963/showip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  show ip
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/subdomain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  subdomain
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/HotSec/hotfinger" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hotfinger
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/HotSec" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubernetes"><a href="#kubernetes" class="header-anchor">#</a> Kubernetes</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>Kubernetes 也称为 K8s，是用于自动部署、扩缩和管理容器化应用程序的开源系统。</p> <p>尽管Kubernetes在Linux上运行，但它与平台无关，可以在裸机，虚拟机，云实例或OpenStack上运行。最新版本的Kubernetes已经支持在Windows上运行。</p> <ul><li>服务发现和负载均衡</li> <li>存储编排</li> <li>自动部署和回滚</li> <li>自动完成装箱计算</li> <li>自动修复</li> <li>密钥与配置管理</li></ul> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <ul><li><p>控制面</p> <ul><li>kube-apiserver</li> <li>kube-scheduler</li> <li>kube-controller-manager</li> <li>etcd</li> <li>Dashboard(可选)</li></ul></li> <li><p>数据面</p> <ul><li>kubelet：主要的节点代理。它监视API服务器以查找已分配给其节点的Pod。 Kubelet执行任务并维护向主节点报告pod状态的反向通道。</li> <li>容器运行时</li> <li>kUbe-proxy 负责维护主机上的网络规则并执行连接转发。它还负责服务中所有Pod的负载平衡。</li></ul></li> <li><p>附加组件</p> <ul><li>DNS服务器 CoreDNS</li> <li>网络插件</li> <li>日志记录代理</li></ul></li> <li><p>CLI</p> <ul><li>kubeadm：用来初始化集群的指令。</li> <li>kubectl：用来与集群通信的命令行工具。</li></ul></li></ul> <h3 id="在部署应用程序时-将发生以下操作"><a href="#在部署应用程序时-将发生以下操作" class="header-anchor">#</a> 在部署应用程序时，将发生以下操作：</h3> <ul><li>你将应用程序清单提交给Kubernetes API。 API Server将清单中定义的对象写入etcd。</li> <li>控制器会注意到新创建的对象，并创建几个新对象。</li> <li>调度程序将Pod分配给每个工作节点。</li> <li>Kubelet注意到已分配给自己的Pod。它通过Container Runtime运行应用程序实例。</li> <li>Kube-proxy会注意到，应用程序实例已准备就绪，可以接受来自客户端的连接并为其配置负载均衡器。</li> <li>Kubelet和控制器监视系统并保持应用程序运行。</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <ul><li><p>minikube</p></li> <li><p>kubeadm</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(&quot;2&quot;) do |config|
  
  config.vm.box = &quot;generic/ubuntu2204&quot;
  config.vm.hostname = &quot;k8s-master&quot;
  config.vm.disk :disk, name: &quot;main&quot;, size: &quot;300GB&quot;
  config.vm.network &quot;public_network&quot;


  # config.vm.synced_folder &quot;../data&quot;, &quot;/vagrant_data&quot;
  # config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true

  config.vm.provider &quot;vmware_desktop&quot; do |vb|
    vb.gui = true
    vb.cpus = 8
    vb.memory = &quot;16384&quot;
  end
  config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL
    lvextend /dev/ubuntu-vg/ubuntu-lv /dev/sda3
    resize2fs /dev/ubuntu-vg/ubuntu-lv
    df -h /
    sudo apt-get update -y
    sudo ufw disable
    # # 将 SELinux 设置为 permissive 模式（相当于将其禁用）
    # sudo setenforce 0
    # sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

    #关闭swap
    sudo swapoff -a  
    sudo sed -ri 's/.*swap.*/#&amp;/' /etc/fstab

    #允许 iptables 检查桥接流量
    sudo cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF
    sudo modprobe overlay
    sudo modprobe br_netfilter
    # 设置所需的 sysctl 参数，参数在重新启动后保持不变
    sudo cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF
    # 应用 sysctl 参数而不重新启动
    sudo sysctl --system
    # sudo mkdir -m 755 /etc/apt/keyrings
    # 安装containerd
    sudo apt-get install ca-certificates curl gnupg -y 
    sudo install -m 0755 -d /etc/apt/keyring
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    sudo chmod a+r /etc/apt/keyrings/docker.gpg
    echo \
    &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
    &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \
    sudo tee /etc/apt/sources.list.d/docker.list
    sudo apt-get update -y
    sudo apt-get install containerd.io -y 

    # wget https://github.com/containernetworking/plugins/releases/download/v1.3.0/cni-plugins-linux-amd64-v1.3.0.tgz
    # sudo  mkdir -p /opt/cni/bin
    # sudo tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.3.0.tgz
    # containerd config default &gt; /etc/containerd/config.toml

    #   [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]
    # ...
    # [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
    #   SystemdCgroup = true
    # sudo systemctl restart containerd

    # sudo apt-get install -y apt-transport-https ca-certificates curl gpg
    # sudo curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
    # sudo chmod a+r /etc/apt/keyrings/docker.gpg
    # sudo echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
    # sudo apt-get update -y
    # sudo apt-get install -y kubelet kubeadm kubectl
    # sudo apt-mark hold kubelet kubeadm kubectl

    # kubeadm config images pull  --image-repository registry.aliyuncs.com/google_containers
    # ctr -n k8s.io i tag registry.aliyuncs.com/google_containers/pause:3.9 registry.k8s.io/pause:3.6 
    # sudo kubeadm init  --apiserver-advertise-address=192.168.234.156  --pod-network-cidr=192.168.0.0/16 --image-repository registry.aliyuncs.com/google_containers 

    # export KUBECONFIG=/etc/kubernetes/admin.conf


    # Your Kubernetes control-plane has initialized successfully!

    # To start using your cluster, you need to run the following as a regular user:

    #   mkdir -p $HOME/.kube
    #   sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
    #   sudo chown $(id -u):$(id -g) $HOME/.kube/config

    # Alternatively, if you are the root user, you can run:

    #   export KUBECONFIG=/etc/kubernetes/admin.conf

    # You should now deploy a pod network to the cluster.
    # Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
    #   https://kubernetes.io/docs/concepts/cluster-administration/addons/

    # Then you can join any number of worker nodes by running the following on each as root:

    # kubeadm join 192.168.234.156:6443 --token 7hmrqw.ypwg6m9z5j4v8brq \
    #         --discovery-token-ca-cert-hash sha256:5ccd48a83cfe4a810327e80f1cb9cc68f8a05095850acf3d23fae90d618b7d98


    # sudo kubeadm init --pod-network-cidr=192.168.0.0/16
    # sudo kubeadm init \
    # --apiserver-advertise-address=192.168.234.155 \
    # --control-plane-endpoint=cluster-endpoint \
    # --service-cidr=10.96.0.0/16 \
    # --pod-network-cidr=192.168.0.0/16
  
    kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/tigera-operator.yaml

    kubectl taint nodes --all node-role.kubernetes.io/control-plane-
  
  SHELL
end

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div></li> <li><p>kubekey</p></li></ul> <h2 id="命令参考"><a href="#命令参考" class="header-anchor">#</a> 命令参考</h2> <p>您可以参考以下 kubectl 命令。<a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/" target="_blank" rel="noopener noreferrer">了解更多<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/kubectl/" target="_blank" rel="noopener noreferrer">kubectl | Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="自定义输出"><a href="#自定义输出" class="header-anchor">#</a> 自定义输出</h3> <ul><li><p>查看容器组的更多信息</p> <ul><li><code>kubectl get pod &lt;容器组名称&gt; -o wide</code></li></ul></li> <li><p>查看 YAML 格式的容器组详情</p> <ul><li><code>kubectl get pod &lt;容器组名称&gt; -o yaml</code></li></ul></li></ul> <h3 id="执行操作"><a href="#执行操作" class="header-anchor">#</a> 执行操作</h3> <h4 id="创建资源"><a href="#创建资源" class="header-anchor">#</a> 创建资源</h4> <ul><li><p>使用 YAML 配置文件创建服务</p> <ul><li><code>kubectl create -f my-service.yaml</code></li></ul></li> <li><p>使用目录下的所有 YAML、YML 和 JSON 文件创建资源</p> <ul><li><code>kubectl create -f &lt;目录&gt;</code></li></ul></li></ul> <h4 id="查看资源"><a href="#查看资源" class="header-anchor">#</a> 查看资源</h4> <ul><li><p>查看所有容器组</p> <ul><li><code>kubectl get pods</code></li></ul></li> <li><p>查看所有服务</p> <ul><li><code>kubectl get services</code></li></ul></li></ul> <h4 id="查看资源详情"><a href="#查看资源详情" class="header-anchor">#</a> 查看资源详情</h4> <ul><li><p>查看节点详情</p> <ul><li><code>kubectl describe nodes &lt;节点名称&gt;</code></li></ul></li> <li><p>查看容器组详情</p> <ul><li><code>kubectl describe pods &lt;容器组名称&gt;</code></li></ul></li></ul> <h3 id="kubectl-h"><a href="#kubectl-h" class="header-anchor">#</a> kubectl  -h</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> kubectl  -h
kubectl controls the Kubernetes cluster manager.

 Find <span class="token function">more</span> information at: https://kubernetes.io/docs/reference/kubectl/overview/

Basic Commands <span class="token punctuation">(</span>Beginner<span class="token punctuation">)</span>:
  create        Create a resource from a <span class="token function">file</span> or from stdin.
  expose        使用 replication controller, service, deployment 或者 pod 并暴露它作为一个 新的 Kubernetes
Service
  run           在集群中运行一个指定的镜像
  <span class="token builtin class-name">set</span>           为 objects 设置一个指定的特征

Basic Commands <span class="token punctuation">(</span>Intermediate<span class="token punctuation">)</span>:
  explain       查看资源的文档
  get           显示一个或更多 resources
  edit          在服务器上编辑一个资源
  delete        Delete resources by filenames, stdin, resources and names, or by resources and label selector

Deploy Commands:
  rollout       Manage the rollout of a resource
  scale         Set a new size <span class="token keyword">for</span> a Deployment, ReplicaSet or Replication Controller
  autoscale     Auto-scale a Deployment, ReplicaSet, StatefulSet, or ReplicationController

Cluster Management Commands:
  certificate   修改 certificate 资源.
  cluster-info  显示集群信息
  <span class="token function">top</span>           显示 Resource <span class="token punctuation">(</span>CPU/Memory<span class="token punctuation">)</span> 使用.
  cordon        标记 <span class="token function">node</span> 为 unschedulable
  uncordon      标记 <span class="token function">node</span> 为 schedulable
  drain         Drain <span class="token function">node</span> <span class="token keyword">in</span> preparation <span class="token keyword">for</span> maintenance
  taint         更新一个或者多个 <span class="token function">node</span> 上的 taints

Troubleshooting and Debugging Commands:
  describe      显示一个指定 resource 或者 group 的 resources 详情
  logs          输出容器在 pod 中的日志
  attach        Attach 到一个运行中的 container
  <span class="token builtin class-name">exec</span>          在一个 container 中执行一个命令
  port-forward  Forward one or <span class="token function">more</span> <span class="token builtin class-name">local</span> ports to a pod
  proxy         运行一个 proxy 到 Kubernetes API server
  <span class="token function">cp</span>            复制 files 和 directories 到 containers 和从容器中复制 files 和 directories.
  auth          Inspect authorization
  debug         Create debugging sessions <span class="token keyword">for</span> troubleshooting workloads and nodes

Advanced Commands:
  <span class="token function">diff</span>          Diff live version against would-be applied version
  apply         通过文件名或标准输入流<span class="token punctuation">(</span>stdin<span class="token punctuation">)</span>对资源进行配置
  patch         Update field<span class="token punctuation">(</span>s<span class="token punctuation">)</span> of a resource
  replace       通过 filename 或者 stdin替换一个资源
  <span class="token function">wait</span>          Experimental: Wait <span class="token keyword">for</span> a specific condition on one or many resources.
  kustomize     Build a kustomization target from a directory or URL.

Settings Commands:
  label         更新在这个资源上的 labels
  annotate      更新一个资源的注解
  completion    Output shell completion code <span class="token keyword">for</span> the specified shell <span class="token punctuation">(</span>bash or <span class="token function">zsh</span><span class="token punctuation">)</span>

Other Commands:
  api-resources Print the supported API resources on the server
  api-versions  Print the supported API versions on the server, <span class="token keyword">in</span> the form of <span class="token string">&quot;group/version&quot;</span>
  config        修改 kubeconfig 文件
  plugin        Provides utilities <span class="token keyword">for</span> interacting with plugins.
  version       输出 client 和 server 的版本信息

Usage:
  kubectl <span class="token punctuation">[</span>flags<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Use <span class="token string">&quot;kubectl &lt;command&gt; --help&quot;</span> <span class="token keyword">for</span> <span class="token function">more</span> information about a given command.
Use <span class="token string">&quot;kubectl options&quot;</span> <span class="token keyword">for</span> a list of global command-line options <span class="token punctuation">(</span>applies to all commands<span class="token punctuation">)</span>.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="核心组件"><a href="#核心组件" class="header-anchor">#</a> 核心组件</h2> <h3 id="node"><a href="#node" class="header-anchor">#</a> Node</h3> <h3 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h3> <ul><li><p>Pod是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。</p></li> <li><p>Pod 可以被理解成一群可以共享网络、存储和计算资源的容器化服务的集合.</p></li> <li><p>同一个 Pod 之间的 Container 可以通过 localhost 互相访问，并且可以挂载 Pod 内所有的数据卷；但是不同的 Pod 之间的 Container 不能用 localhost 访问，也不能挂载其他 Pod 的数据卷。</p></li> <li><p>一个 Pod 内可以有多个容器 container。</p> <ul><li>标准容器 Application Container。</li> <li>初始化容器 Init Container。</li> <li>边车容器 Sidecar Container。</li> <li>临时容器 Ephemeral Container。</li></ul></li></ul> <blockquote><p>https://zhuanlan.zhihu.com/p/651130502</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1    <span class="token comment"># 记录k8s的apiserver版本，目前都是v1</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod        <span class="token comment"># 类型 Pod</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>         <span class="token comment"># 记录了pod自身的元数据</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> memory<span class="token punctuation">-</span>demo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> mem<span class="token punctuation">-</span>example   <span class="token comment"># 所属的命名空间</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>            <span class="token comment"># 记录了pod内部资源的详细信息</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>    <span class="token comment"># 容器信息</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> memory<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>ctr
    <span class="token key atrule">image</span><span class="token punctuation">:</span> polinux/stress 
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>    <span class="token comment"># 资源配额</span>
      <span class="token key atrule">limits</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;200Mi&quot;</span>
      <span class="token key atrule">requests</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">&quot;100Mi&quot;</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stress&quot;</span><span class="token punctuation">]</span> <span class="token comment"># 容器入口命令</span>
    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--vm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--vm-bytes&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;150M&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--vm-hang&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">]</span> <span class="token comment"># 入口命令参数</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> <span class="token comment"># 挂载数据卷</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>storage
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data/redis
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>    <span class="token comment"># 数据卷信息</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>storage
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="service"><a href="#service" class="header-anchor">#</a> Service</h3> <p>将运行在一组 Pods 上的应用程序公开为网络服务的抽象方法。</p> <h3 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h3> <p>Ingress 是对集群中服务的外部访问进行管理的 API 对象，典型的访问方式是 HTTP。
Ingress 可以提供负载均衡、SSL 终结和基于名称的虚拟托管。</p> <h3 id="configmap"><a href="#configmap" class="header-anchor">#</a> ConfigMap</h3> <h3 id="secret"><a href="#secret" class="header-anchor">#</a> Secret</h3> <h3 id="volumes"><a href="#volumes" class="header-anchor">#</a> Volumes</h3> <h3 id="deployment"><a href="#deployment" class="header-anchor">#</a> Deployment</h3> <p>Deployment 的作用是管理和控制 Pod 和 ReplicaSet，管控它们运行在用户期望的状态中</p> <ul><li>部署无状态应用</li></ul> <h3 id="statefulset"><a href="#statefulset" class="header-anchor">#</a> StatefulSet</h3> <ul><li>部署有状态应用</li></ul> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <ul><li>kubectl</li> <li>master
<ul><li>Control plane
<ul><li>API server</li> <li>scheduler</li> <li>Controller Manager
<ul><li>监控和检测故障</li></ul></li> <li>etcd
<ul><li>存储集群中所有资源对象的信息</li></ul></li> <li>云控制管理器（使用云服务商的集群时会有）</li></ul></li></ul></li> <li>Node
<ul><li>kubelet</li> <li>kube-proxy</li> <li>container-runtime</li></ul></li></ul> <h2 id="cni-容器网络接口"><a href="#cni-容器网络接口" class="header-anchor">#</a> CNI 容器网络接口</h2> <h2 id="csi-容器存储接口"><a href="#csi-容器存储接口" class="header-anchor">#</a> CSI 容器存储接口</h2> <h2 id="cri-容器运行时接口"><a href="#cri-容器运行时接口" class="header-anchor">#</a> CRI 容器运行时接口</h2> <ul><li>主要的运行时
<ul><li>RunC：  linux容器，比如docker</li> <li>RunV：安全容器，轻量级虚拟机。比如kata、firecracker等</li> <li>Wasm: 具体实现有WasmEdge</li></ul></li></ul> <h2 id="device-plugin"><a href="#device-plugin" class="header-anchor">#</a> Device Plugin</h2> <p>通过Device Plugin机制支持GPU、RDMA、FPGA、InfiniBand等第三方设备资源</p> <h2 id="nri-node资源接口"><a href="#nri-node资源接口" class="header-anchor">#</a> NRI Node资源接口</h2> <ul><li>典型：基于NRI扩展Kubelete CPU管理能力，比如感知L3 cache的智能绑核。</li></ul> <h2 id="ingress-2"><a href="#ingress-2" class="header-anchor">#</a> Ingress</h2> <ul><li>入口流量的标准规范</li> <li>Gateway API</li></ul> <h2 id="调度器扩展-scheduling-framework"><a href="#调度器扩展-scheduling-framework" class="header-anchor">#</a> 调度器扩展 Scheduling Framework</h2> <ul><li>离线调度方案</li></ul> <h2 id="ccm扩展"><a href="#ccm扩展" class="header-anchor">#</a> CCM扩展</h2> <h2 id="api扩展-apserver-原生资源cm扩展"><a href="#api扩展-apserver-原生资源cm扩展" class="header-anchor">#</a> API扩展  APServer + 原生资源CM扩展</h2> <ul><li>dynamic admission control 动态准入控制</li> <li>CRD+Operator
<ul><li>定制自己的工作负载类型，支持原地升级、灰度发布等高级策略 OpenKruise</li></ul></li> <li>Aggregated APIServer 客户定制api需求的解决方案
<ul><li>metrics server</li></ul></li></ul> <h3 id="operator-sdk-工作流"><a href="#operator-sdk-工作流" class="header-anchor">#</a> Operator SDK 工作流</h3> <p>开发一个新的 Operator：</p> <ol><li>使用 SDK 创建一个新的 Operator 项目</li> <li>通过添加自定义资源（CRD）定义新的资源 API</li> <li>指定使用 SDK API 来 watch 的资源</li> <li>定义 Operator 的协调（reconcile）逻辑</li> <li>使用 Operator SDK 构建并生成 Operator 部署清单文件</li></ol> <h2 id="排查"><a href="#排查" class="header-anchor">#</a> 排查</h2> <p><img src="image/k8s%E7%AC%94%E8%AE%B0/1703669619735.png" alt="1703669619735"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/4/2024, 10:16:52 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c319bac8.js" defer></script><script src="/assets/js/2.ee734a59.js" defer></script><script src="/assets/js/92.1f9fa6f9.js" defer></script>
  </body>
</html>
