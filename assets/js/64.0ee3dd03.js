(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{471:function(s,a,t){"use strict";t.r(a);var e=t(56),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"playwright"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playwright"}},[s._v("#")]),s._v(" playwright")]),s._v(" "),t("h2",{attrs:{id:"入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#入门"}},[s._v("#")]),s._v(" 入门")]),s._v(" "),t("p",[t("code",[s._v("https://playwright.dev/")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade pip\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" playwright\nplaywright "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("code",[s._v("PLAYWRIGHT_BROWSERS_PATH=0 playwright install chromium pyinstaller -F main.py")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.zhihu.com/search?q=%E6%8E%A7%E5%88%B6%E5%8F%B0&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("控制台"),t("OutboundLink")],1),s._v("启动录制")]),s._v(" "),t("p",[s._v("playwright codegen [options] [url]")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("output ：保存生成脚本\n–target ：生成的脚本语言，可以设置javascript"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" python"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v("和csharp，默认为python\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("browser ：要使用的浏览器，可以选择cr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" chromium"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" firefox"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wk和webkit，默认chromium。\n–channel ：chromium版本，比如chrome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" chrome"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("beta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msedge"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev等\n–color"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheme ：模拟器的颜色主题，可选择light 或者 dark样式\n–device ：模拟的设备\n–save"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("storage ：保存上下文状态，用于保存cookies 和localStorage，可用它来实现重用。例如playwright codegen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("save"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("storage"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n–load"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("storage ：加载–save"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("storage 保存的数据，重用认证数据。\n–proxy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server ：指定代理服务器\n–timezone ： 指定时区\n–geolocation ：指定地理位置坐标\n–lang ：指定语言"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("地区，比如中国大陆：zh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CN\n–timeout ：超时时间，定位毫秒，默认10000ms\n–user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("agent ：用户代理\n–viewport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size ：浏览器窗口大小\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("help")]),s._v(" ：查看帮助信息\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('playwright codegen -o test_playwright.py --target python  -b chromium --device="iPhone 12 Pro" https://www.baidu.com/\n\nplaywright open https://www.baidu.com/ # 默认使用Chromium打开\nplaywright wk https://www.baidu.com/ # 使用WebKit打开\nplaywright open --device="iPhone 12 Pro" https://www.baidu.com/ # 使用iPhone 12 Pro模拟器打开\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("基本用法")]),s._v(" "),t("h3",{attrs:{id:"常见配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见配置参数"}},[s._v("#")]),s._v(" 常见配置参数")]),s._v(" "),t("p",[s._v("headless，slow_mo，viewport，locale，timezone，"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=color_scheme&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("color_scheme"),t("OutboundLink")],1),s._v("，geolocation，user_agent， timeout, proxy")]),s._v(" "),t("h3",{attrs:{id:"同步模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#同步模式"}},[s._v("#")]),s._v(" 同步模式")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("from playwright.sync_api import sync_playwright\n\nwith sync_playwright() as p:\n # 创建一个浏览器实例； headless：是否无头；slow_mo放慢执行速度\n\n # pixel_2 = playwright.devices['Pixel 2']  # Pixel 2 一款安卓手机\n proxy_ip = {\n            'server': 'http://',\n            'username': '',\n            'password': '',\n        }\n    browser = p.chromium.launch(headless=False, slow_mo=100, proxy=proxy_ip)\n context = browser.new_context(\n            viewport={'width': 1800, 'height': 800}, # 窗口大小\n            locale='zh-CN',  #语言zh-CN/en-EN\n            timezone='Europe/Rome',   #时区\n            color_scheme='dark', # 颜色\n            geolocation={\"longitude\": 48.858455, \"latitude\": 2.294474} # 地理位置\n            user_agent='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36', # 浏览器,\n            timeout=10000, # 超时\n            # **pixel_2,\n        )\n\n    # 创建两个浏览器上下文\n    page = browser.new_page()\n    page.goto('http://www.baidu.com')\n    print(page.title)\n    browser.close()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"异步模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步模式"}},[s._v("#")]),s._v(" 异步模式")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('import asyncio\nfrom playwright.async_api import async_playwright\nasync def main():\n    async with async_playwright() as p:\n        browser = await p.chromium.launch(headless=False)\n        page = await browser.new_page()\n        await page.goto("http://www.baidu.com")\n        print(await page.title())\n        await browser.close()\n\nasyncio.run(main())\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"防止webdriver-被检测"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防止webdriver-被检测"}},[s._v("#")]),s._v(" 防止WebDriver 被检测")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('js = """ Object.defineProperties(navigator,{webdriver:{get:()=>undefined}}; """ page.add_init_script(js)  \n或者 page.add_init_script("""Object.defineProperties(navigator, {webdriver:{get:()=>undefined}});""")\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"获取源码-文本-属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取源码-文本-属性"}},[s._v("#")]),s._v(" 获取源码，文本，属性")]),s._v(" "),t("p",[s._v("获取源码: .content()")]),s._v(" "),t("p",[s._v("page.wait_for_load_state('networkidle') html = page.content()")]),s._v(" "),t("p",[s._v("获取文本: .text_content()")]),s._v(" "),t("p",[t("em",[s._v("# ul->li下")]),s._v(" brand = element.query_selector('text=品牌：').text_content()  name = ele_items.query_selector('section > div._3KXtu._3jY37 > a').text_content()")]),s._v(" "),t("p",[s._v("获取属性: ."),t("a",{attrs:{href:"https://www.zhihu.com/search?q=get_attribute&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("get_attribute"),t("OutboundLink")],1),s._v("()")]),s._v(" "),t("p",[t("em",[s._v("# ul->li下")]),s._v(" link = element.query_selector('h5 a').get_attribute('href')")]),s._v(" "),t("p",[s._v("wait_for_load_state")]),s._v(" "),t("p",[s._v('"commit ": 接收到网络响应且文档开始加载时(仅显示了页面默认窗口视图下的元素) "'),t("a",{attrs:{href:"https://www.zhihu.com/search?q=domcontentloaded&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("domcontentloaded"),t("OutboundLink")],1),s._v('": 认为在 DOMContentLoaded 事件完成时(显示了完整页面) "load": 在 load 事件完成时操作完成(含了所有图片资源) "'),t("a",{attrs:{href:"https://www.zhihu.com/search?q=networkidle&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("networkidle"),t("OutboundLink")],1),s._v('": 至少 500 毫秒内没有网络连接时操作完成  页面加载的整个状态变化 Commit -> DOMContentLoaded -> load -> networkidle')]),s._v(" "),t("h3",{attrs:{id:"监听-response-事件-page-on"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监听-response-事件-page-on"}},[s._v("#")]),s._v(" 监听 response 事件：page.on()")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('"commit ": 接收到网络响应且文档开始加载时(仅显示了页面默认窗口视图下的元素)\n"domcontentloaded": 认为在 DOMContentLoaded 事件完成时(显示了完整页面)\n"load": 在 load 事件完成时操作完成(含了所有图片资源)\n"networkidle": 至少 500 毫秒内没有网络连接时操作完成\n\n页面加载的整个状态变化\nCommit -> DOMContentLoaded -> load -> networkidle\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("em",[t("strong",[s._v("监听弹窗")])])]),s._v(" "),t("p",[s._v("with page.expect_popup() as popup:  page.evaluate('window.open()') popup.value.goto('"),t("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//www.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www."),t("strong",[s._v("baidu.com")]),t("OutboundLink")],1),s._v("')")]),s._v(" "),t("p",[t("em",[t("strong",[s._v("监听请求")])])]),s._v(" "),t("p",[s._v("with page.expect_request('**/"),t("em",[s._v("login")]),s._v(".png') as first:  page.goto('"),t("a",{attrs:{href:"https://link.zhihu.com/?target=http%3A//www.baidu.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www."),t("strong",[s._v("baidu.com")]),t("OutboundLink")],1),s._v("') print(first.value.url)")]),s._v(" "),t("p",[t("strong",[s._v("传参监听")])]),s._v(" "),t("p",[s._v("page.on('"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=response&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("response"),t("OutboundLink")],1),s._v("', lambda response: on_response(response, id)) for (url, id) in urls:   pass")]),s._v(" "),t("h3",{attrs:{id:"滚动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#滚动"}},[s._v("#")]),s._v(" "),t("strong",[s._v("滚动")])]),s._v(" "),t("p",[s._v("下拉滚动条")]),s._v(" "),t("p",[s._v('page.evaluate("var q=document.documentElement.scrollTop=15000")')]),s._v(" "),t("p",[s._v("鼠标滚动")]),s._v(" "),t("p",[s._v("page.mouse.wheel(0,7000)")]),s._v(" "),t("h3",{attrs:{id:"截图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#截图"}},[s._v("#")]),s._v(" 截图")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(' with sync_playwright() as p:\n        browser = p.chromium.launch(headless=False, slow_mo=50)\n        page = browser.new_page()\n        page.goto("http://www.baidu.com")\n        page.screenshot(path="example.png")\n        browser.close()\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"获取cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取cookie"}},[s._v("#")]),s._v(" "),t("strong",[s._v("获取cookie")])]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("browser = playwright.chromium.launch(headless=False) \ncontext = browser.new_context()  \ncookies = context.storage_state()\ncookie = '; '.join([f'{key[\"name\"]}={key[\"value\"]}' for key in cookies['cookies']])\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"css-xpath选择器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#css-xpath选择器"}},[s._v("#")]),s._v(" CSS，xpath选择器")]),s._v(" "),t("p",[s._v("t伪类选择器\n"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=has-text&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("has-text"),t("OutboundLink")],1),s._v("()：检测包含（返回找到的所有元素）\ntext()：检测等于（返回第一个找到的元素）")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 选择文本是 Log in 的节点，并点击\npage.click("text=Log in",timeout=5000)\npage.click("text=你好，请登录")\n\npage.locator(\':has-text("All products")\').click() \n\npage.locator("#nav-bar :text(\'Contact us\')").click()\npage.locator(\'[data-test=login-button]\').click()\npage.locator("[aria-label=\'Sign in\']").click()\n\n# 选择 id 为 nav-bar 子孙节点 class 属性值为 contact-us-item，并点击\npage.click("#nav-bar .contact-us-item")\n \n# 选择文本中包含 Playwright 的 article 节点\npage.click("article:has-text(\'Playwright\')")\n \n# 选择 id 为 nav-bar 节点中文本值等于 Contact us 的节点\npage.click("#nav-bar :text(\'Contact us\')")\n \n# 选择 class 为 item-description 的节点，且该节点还要包含 class 为 item-promo-banner 的子节点\npage.click(".item-description:has(.item-promo-banner)")\n \n# 择的就是一个 input 节点，并且该 input 节点要位于文本值为 Username 的节点的右侧\npage.click("input:right-of(:text(\'Username\'))")\n\n# xpath\npage.click("xpath=//button")\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h3",{attrs:{id:"get-by-xxx定位器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get-by-xxx定位器"}},[s._v("#")]),s._v(" get_by_xxx"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=%E5%AE%9A%E4%BD%8D%E5%99%A8&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("定位器"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("●"),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-text",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_text（文本，**kwargs）按文本内容定位"),t("OutboundLink")],1),s._v("。\n●"),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-role",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_role（角色，**kwargs）按角色属性"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("●"),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-label",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_label（文本，**kwargs）通过关联标签的文本查找表单控件"),t("OutboundLink")],1),s._v("\n● "),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-test-id",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_test_id（test_id）根据元素的属性定位元素（可以配置其他属性）"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-placeholder",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_placeholder（文本，**kwargs）"),t("OutboundLink")],1),s._v("按"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=%E5%8D%A0%E4%BD%8D%E7%AC%A6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("占位符"),t("OutboundLink")],1),s._v("查找输入")]),s._v(" "),t("p",[s._v("● "),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-alt-text",target:"_blank",rel:"noopener noreferrer"}},[s._v("通过其文本替代来定位元素"),t("OutboundLink")],1),s._v("，通常是图像。\n●"),t("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//playwright.dev/python/docs/api/class-page%23page-get-by-title",target:"_blank",rel:"noopener noreferrer"}},[s._v("page.get_by_title（文本，**kwargs）"),t("OutboundLink")],1),s._v("按标题定位元素。")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('page.get_by_label("Password").fill("secret-password")\n\npage.get_by_role("option", name="全部企业").click()\npage.get_by_role("button", name="Sign in").click()\n\n# 关闭详情弹窗\npage.frame_locator("internal:attr=[title=\\"详情页\\"i]").locator(\n                "#enterprise-details-close").click()\n\n# 文本内容\npage.get_by_text(str(select_text)).click()\n\n# 正则匹配定位\npage.get_by_role("tab", name=re.compile("风险信息", re.IGNORECASE)).click()\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://pic1.zhimg.com/80/v2-56336a3fa6293b8235b2bdc663030f0a_720w.webp?source=1def8aca",alt:""}})]),s._v(" "),t("p",[s._v("**"),t("a",{attrs:{href:"https://www.zhihu.com/search?q=%E5%BE%AA%E7%8E%AF%E9%81%8D%E5%8E%86&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("循环遍历"),t("OutboundLink")],1),s._v("**ul: query_selector_all()")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("uls = page.query_selector_all('//*[@id=\"YZhV9-anchor\"]//table[@class=\"ant-table-fixed\"]/tbody/tr')\nfor ele_items in uls:\n title = ele_items.query_selector('section > div._3KXtu._3jY37 > a').text_content()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("同级第几个：.nth(2)")]),s._v(" "),t("p",[s._v('点击最后一个按钮 page.click("button >> nth=-1")  page.get_by_placeholder("请输入手机号码").nth(1).click()')]),s._v(" "),t("p",[s._v("文本输入：.fill()")]),s._v(" "),t("p",[t("em",[s._v("# 标签定位输入")]),s._v(" page.locator('text=First Name').fill('Peter')  page.get_by_placeholder(\"请输入手机号码\").nth(1).fill('12345678901')")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.zhihu.com/search?q=%E5%AE%9A%E4%BD%8D%E5%99%A8%E8%BF%87%E6%BB%A4%E5%99%A8&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3269710925%7D",target:"_blank",rel:"noopener noreferrer"}},[s._v("定位器过滤器"),t("OutboundLink")],1),s._v("：filter")]),s._v(" "),t("p",[s._v('page.locator("a").filter(has_text="密码登录").click()')]),s._v(" "),t("p",[s._v("刷新，前进，后退")]),s._v(" "),t("p",[s._v("page.reload(**kwargs) "),t("em",[s._v("# 刷新")]),s._v(" page.go_back(**kwargs) "),t("em",[s._v("# 后退")]),s._v(" page.go_forward(**kwargs) "),t("em",[s._v("# 前进")])]),s._v(" "),t("h3",{attrs:{id:"等待"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#等待"}},[s._v("#")]),s._v(" 等待")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 等待直到title元素被加载完全\npage.locator(\"title\").wait_for()   \n\n# 会自动等待按钮加载好再执行点击\npage.locator(\"button\", has_text=\"sign up\").click() \n\n# Playwright 会等待 #search 元素出现在 DOM 中\npage.fill('#search', 'query')\n\n# Playwright 会等待元素停止动画并接受点击\npage.click('#search')\n\n# 等待 #search 出现在 DOM 中\npage.wait_for_selector('#search', state='attached')\n# 等待 #promo 可见, 例如具有 `visibility:visible` \npage.wait_for_selector('#promo')\n\n# 等待 #details 变得不可见, 例如通过 `display:none`.\npage.wait_for_selector('#details', state='hidden')\n\n# 等待 #promo 从 DOM 中移除\npage.wait_for_selector('#promo', state='detached')\n\n\n# 随机等待\npage.wait_for_timeout(random.uniform(2500, 4500))\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"点击"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#点击"}},[s._v("#")]),s._v(" 点击")]),s._v(" "),t("ul",[t("li",[s._v("左键点击：page.click(“id=su”)")]),s._v(" "),t("li",[s._v("点击元素左上角：page.click(‘id=su’, position={‘x’: 0, ‘y’: 0})")]),s._v(" "),t("li",[s._v("Shift + click：page.click(“id=su”, modifiers=[‘Shift’])")]),s._v(" "),t("li",[s._v("强制点击：page.click(“id=su”, force=True)")]),s._v(" "),t("li",[s._v("右键点击：page.click(“id=su”, button=‘right’)")]),s._v(" "),t("li",[s._v("双击：page.dblclick(“id=su”)")]),s._v(" "),t("li",[s._v("悬停在元素上：page.hover(‘id=su’)")])]),s._v(" "),t("h3",{attrs:{id:"模拟键盘输入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模拟键盘输入"}},[s._v("#")]),s._v(" "),t("strong",[s._v("模拟键盘输入")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("page "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" browser.new_page"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.goto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://keycode.info"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.keyboard.press"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.screenshot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.png"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.keyboard.press"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ArrowLeft"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.screenshot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arrow_left.png"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.keyboard.press"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shift+O"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npage.screenshot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o.png"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbrowser.close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\npage.keyboard.type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# types instantly")]),s._v("\npage.keyboard.type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("delay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# types slower, like a user")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("page.press"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id=kw"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Control+A'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("：\nControl+A page.press"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id=kw'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Enter'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 点击回车  *# 一个字符一个字符的输入*")]),s._v("\npage.type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id=kw"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"playwright"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("delay")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个字符延迟100ms输入")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);