(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{438:function(s,a,n){"use strict";n.r(a);var e=n(56),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"openstar"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#openstar"}},[s._v("#")]),s._v(" openstar")]),s._v(" "),n("h1",{attrs:{id:"_1-lua-note"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-lua-note"}},[s._v("#")]),s._v(" 1. lua_note")]),s._v(" "),n("h2",{attrs:{id:"_1-0-0-1-项目介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-0-1-项目介绍"}},[s._v("#")]),s._v(" 1.0.0.1. 项目介绍")]),s._v(" "),n("p",[s._v("lua_note  学习lua时，记录的一点东西")]),s._v(" "),n("h2",{attrs:{id:"感谢大佬们"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#感谢大佬们"}},[s._v("#")]),s._v(" 感谢大佬们")]),s._v(" "),n("p",[s._v("在github上发现云风大佬翻译的lua53的文档，所以不准备在自己整理lua的基础文档了，打算只写自己感觉有意思的东西了")]),s._v(" "),n("p",[s._v("lua53doc项目clone下来可以直接用"),n("code",[s._v("py -m http.server")]),s._v("启动，然后用浏览器浏览文档")]),s._v(" "),n("h1",{attrs:{id:"_1-openresty环境安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-openresty环境安装"}},[s._v("#")]),s._v(" 1. openresty环境安装")]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#_1-0-0-1-项目介绍"}},[s._v("1.0.0.1. 项目介绍")])]),n("li",[n("a",{attrs:{href:"#感谢大佬们"}},[s._v("感谢大佬们")])]),n("li",[n("a",{attrs:{href:"#_1-1-openresty-hello-world"}},[s._v('1.1. OpenResty "hello world"')])]),n("li",[n("a",{attrs:{href:"#_1-2-nginx-conf"}},[s._v("1.2. Nginx.conf")]),n("ul",[n("li",[n("a",{attrs:{href:"#_1-2-1-http块"}},[s._v("1.2.1. HTTP块")])]),n("li",[n("a",{attrs:{href:"#_1-2-2-tcp-udp服务"}},[s._v("1.2.2. TCP/UDP服务")])]),n("li",[n("a",{attrs:{href:"#_1-2-3-日志"}},[s._v("1.2.3. 日志")])])])]),n("li",[n("a",{attrs:{href:"#_1-3-负载均衡"}},[s._v("1.3. 负载均衡")])]),n("li",[n("a",{attrs:{href:"#_1-4-nginx-变量"}},[s._v("1.4. Nginx 变量")])]),n("li",[n("a",{attrs:{href:"#_1-5-nginx下lua实现机制"}},[s._v("1.5. Nginx下Lua实现机制")])]),n("li",[n("a",{attrs:{href:"#_1-6-openresty组成"}},[s._v("1.6. OpenResty组成")])]),n("li",[n("a",{attrs:{href:"#_1-7-openresty目录结构"}},[s._v("1.7. OpenResty目录结构")])]),n("li",[n("a",{attrs:{href:"#_1-8-组件管理工具"}},[s._v("1.8. 组件管理工具")])]),n("li",[n("a",{attrs:{href:"#_1-9-命令行工具"}},[s._v("1.9. 命令行工具")])])])]),n("p"),s._v(" "),n("h2",{attrs:{id:"_1-1-openresty-hello-world"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-openresty-hello-world"}},[s._v("#")]),s._v(' 1.1. OpenResty "hello world"')]),s._v(" "),n("p",[s._v("创建以下目录")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ~/work\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/work\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" logs/ conf/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("创建一个"),n("code",[s._v("conf/nginx.conf")]),s._v("文件")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("worker_processes  1;\nerror_log logs/error.log;\nevents {\n    worker_connections 1024;\n}\nhttp {\n    server {\n        listen 8080;1\n        location / {\n            default_type text/html;\n            content_by_lua '\n                ngx.say(\"<p>hello, world</p>\")\n            ';\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[n("code",[s._v("curl http://localhost:8080")])]),s._v(" "),n("p",[s._v("nginx多实例，只需要把OpenRestry中的Nginx目录复制一份就可以。")]),s._v(" "),n("p",[s._v("cp -r /usr/local/openrestry/nginx /usr/local/openrestry/nginx_9090")]),s._v(" "),n("p",[s._v("然后修改nginx.conf中的端口从8080改为9090,把hello world改为hello 9090")]),s._v(" "),n("p",[s._v("/usr/local/openrestry/nginx_9090/sbin/nginx -p /usr/local/openrestry/nginx_9090")]),s._v(" "),n("p",[s._v("压力测试 "),n("code",[s._v("ab -c 100 -n 10000 127.0.0.1:8088/hello")]),s._v(" 并发100个连接，10000个请求")]),s._v(" "),n("h2",{attrs:{id:"_1-2-nginx-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-nginx-conf"}},[s._v("#")]),s._v(" 1.2. Nginx.conf")]),s._v(" "),n("blockquote",[n("p",[s._v("https://blog.csdn.net/jackliu16/article/details/79444327")])]),s._v(" "),n("p",[s._v("nginx配置文件：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("#")]),s._v(" 单行注释")]),s._v(" "),n("li",[s._v("单引号或者双引号 -- 定义字符串   "),n("code",[s._v("\\")]),s._v(" 可以使用转义字符")]),s._v(" "),n("li",[s._v("使用 "),n("code",[s._v("$var")]),s._v(" 可以引用预定义的一些变量")]),s._v(" "),n("li",[s._v("配置指令以分号结束，可以接受多个参数，用空白字符分隔")]),s._v(" "),n("li",[s._v("配置块（block）是特殊的配置指令，它有一个 "),n("code",[s._v("{}")]),s._v(" 参数而且无需分号结束， "),n("code",[s._v("{}")]),s._v(" 里面可以书写多个配置指令，配置块也允许嵌套")]),s._v(" "),n("li",[s._v("使用 "),n("code",[s._v("include")]),s._v(" 指令可以包含其他配置文件，支持 "),n("code",[s._v("*")]),s._v(" 通配符")]),s._v(" "),n("li",[s._v("不能识别或错误的配置指令会导致nginx启动失败")])]),s._v(" "),n("h3",{attrs:{id:"_1-2-1-http块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-http块"}},[s._v("#")]),s._v(" 1.2.1. HTTP块")]),s._v(" "),n("p",[n("strong",[s._v("HTTP服务")]),s._v("\n配置HTTP服务相关的功能需要指令http{},常用形式如下：")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n    server {\n        listen 80;\n        locatim uri {\n            ...\n        }\n    }\n\n    server {        # server 块，第二个Web服务\n        listen xxx;\n        ...\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("可以使用"),n("code",[s._v("include")])]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {  # http配置块的开始，所有HTTP相关功能\n    include common.conf     # 基本的HTTP配置模块，配置通用参数\n    include servers/*.conf      # 包含 servers目录下所有web服务配置文件\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("server配置")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n    server {\n        listen 8080;    # 监听端口，默认是80\n        server_name *.*;  # OpenResty处理请求时会检查HTTP头部的Host字段，只有与server_name匹配的server块才这真正提供服务  \n        location / {\n            ...\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("location配置")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n    server {\n        listen 80;\n        location [=|~|~*|^~] uri {  # URI必须完全匹配 | 大小写敏感匹配 | 大小写不敏感匹配 | 前缀匹配，匹配URI前半部分即可\n             ...\n        }\n        location /item/  {  # 前缀匹配/item/*\n            ...\n        }\n        location / {    # 匹配任意的URI\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("blockquote",[n("p",[s._v("在server块里可以配置任意数量的location块，定义Web服务接口。Nginx查找location的顺序没有特殊要求，并不是按照配置文件里的顺序逐个查找，而是所有可能的匹配进行排序，查找最佳匹配的location。")])]),s._v(" "),n("h3",{attrs:{id:"_1-2-2-tcp-udp服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-tcp-udp服务"}},[s._v("#")]),s._v(" 1.2.2. TCP/UDP服务")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("stream {        # stream块，TCP/UDP相关功能\n    server {    # server块，第一个Web服务\n        listen 53;\n    }\n\n    server {    # server块，第二个Web服务\n        listen 520 udp;\n        ...\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("定义TCP、UDP服务同样需要使用server指令，然后再用listen指令确定服务使用的具体端口号。"),n("em",[s._v("但因为TCP/UDP协议里没有Host URI的概念，所以server块里是不能使用server_name和location指令，这是与HTTP服务不同的地方，需要注意")])]),s._v(" "),n("h3",{attrs:{id:"_1-2-3-日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-日志"}},[s._v("#")]),s._v(" 1.2.3. 日志")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 使用格式main  使用8KB的缓存，每1s刷新一次\nlog_format main `$remote_addr ...`;\naccess_log /var/logs/openresty/access.log main buffer=8k flush=1s;  \n\nerror_log logs/error.log error;  # 默认存放路径是安装目录下的logs/error.log。 第二个参数是输出日志的级别，高于这个级别的日志才会记录下来  debug|info|notice|warn|error|crit|alert|emerg\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_1-3-负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-负载均衡"}},[s._v("#")]),s._v(" 1.3. 负载均衡")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n    upstream backend {\n        least_conn;        # 负载均衡策略\n        server 127.0.0.1:80;  # 一台上游服务器\n        server ... weight=3;    # 可以指定多台上游服务器\n        server ... backup;      # 备份用的上游服务器\n        keepalive 32;       # 使用连接池，长连接复用\n    }\n\n    server {\n        listen 8088;\n\n        location /passto {\n            proxy_set_header Host $host;   # 使用变量转发原始请求的host头部\n            proxy_pass http://backend;  # 转发到upstream块定义的服务器集群\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"_1-4-nginx-变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-nginx-变量"}},[s._v("#")]),s._v(" 1.4. Nginx 变量")]),s._v(" "),n("p",[s._v("在HTTP服务里常见的变量(以"),n("code",[s._v("curl 'http://loclhost/index.html??a=1&b=2' -H 'hello: world'")]),s._v(")：")]),s._v(" "),n("ul",[n("li",[s._v("$uri   : /index.html")]),s._v(" "),n("li",[s._v("$args  : a=1&b=2")]),s._v(" "),n("li",[s._v("$arg_a : 1")]),s._v(" "),n("li",[s._v("$arg_b : 2")]),s._v(" "),n("li",[s._v("$http_hello : world")]),s._v(" "),n("li",[s._v("$sent_http_server : openresty/1.13.6.2")]),s._v(" "),n("li",[s._v("$remove_addr      : 127.0.0.1")])]),s._v(" "),n("p",[s._v("Nginx内置的变量很多，也可以使用指自定义变量，最常用的就是set，例如：")]),s._v(" "),n("p",[n("code",[s._v('set $max_size 10000 # 定义变量 $max_size="10000"')])]),s._v(" "),n("h2",{attrs:{id:"_1-5-nginx下lua实现机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-nginx下lua实现机制"}},[s._v("#")]),s._v(" 1.5. Nginx下Lua实现机制")]),s._v(" "),n("h2",{attrs:{id:"_1-6-openresty组成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-openresty组成"}},[s._v("#")]),s._v(" 1.6. OpenResty组成")]),s._v(" "),n("ol",[n("li",[s._v("Nginx")]),s._v(" "),n("li",[s._v("LuaJIT")]),s._v(" "),n("li",[s._v("ngx_lua")]),s._v(" "),n("li",[s._v("stream_lua")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("ngx_iconv     :转换不同的字符集编码")])]),s._v(" "),n("li",[n("p",[s._v("ngx_encrypted     :使用AES-256算法执行简单的加密运算")])]),s._v(" "),n("li",[n("p",[s._v("ngx_echo")])]),s._v(" "),n("li",[n("p",[s._v("ngx_set_misc")])]),s._v(" "),n("li",[n("p",[s._v("ngx_headers_more")])]),s._v(" "),n("li",[n("p",[s._v("ngx_memc      : 支持各种memcached操作")])]),s._v(" "),n("li",[n("p",[s._v("lua_core")])]),s._v(" "),n("li",[n("p",[s._v("lua_cjson")])]),s._v(" "),n("li",[n("p",[s._v("lua_string")])]),s._v(" "),n("li",[n("p",[s._v("lua_upload")])]),s._v(" "),n("li",[n("p",[s._v("lua_redis")])]),s._v(" "),n("li",[n("p",[s._v("lua_memcached")])]),s._v(" "),n("li",[n("p",[s._v("lua_mysql")])]),s._v(" "),n("li",[n("p",[s._v("lua_dns")])]),s._v(" "),n("li",[n("p",[s._v("lua_lrucache")])]),s._v(" "),n("li",[n("p",[s._v("lua_lock")])]),s._v(" "),n("li",[n("p",[s._v("lua_websocket")])]),s._v(" "),n("li",[n("p",[s._v("lua_healthcheck")])]),s._v(" "),n("li",[n("p",[s._v("lua_limit_traffic 使用lu定制更灵活的流量控制策略")])])]),s._v(" "),n("hr"),s._v(" "),n("ul",[n("li",[s._v("opm 类似rpm、npm的包管理工具")]),s._v(" "),n("li",[s._v("resty-cli 以命令行的形式直接执行OpenResty/Lua程序")]),s._v(" "),n("li",[s._v("restydoc 类似man的参考手册")])]),s._v(" "),n("p",[n("img",{attrs:{src:"img/openresty_zucheng.png",alt:"openresty"}})]),s._v(" "),n("h2",{attrs:{id:"_1-7-openresty目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-openresty目录结构"}},[s._v("#")]),s._v(" 1.7. OpenResty目录结构")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\n├── bin  \n├── luajit\n├── lualib\n├── nginx\n├── pod\n└── site\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"_1-8-组件管理工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-组件管理工具"}},[s._v("#")]),s._v(" 1.8. 组件管理工具")]),s._v(" "),n("p",[s._v("opm")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("opm search http\n    get\n    info\n    remove\nopm --install-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt  get xxx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把xxx组建安装到 /opt 目录下")]),s._v("\nopm --cwd               get xxx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装到当前目录的/resty_modules下")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"_1-9-命令行工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-命令行工具"}},[s._v("#")]),s._v(" 1.9. 命令行工具")]),s._v(" "),n("p",[s._v("resty可以当作一个lua解释器来用（但是运行再OpenResty环境里)。")]),s._v(" "),n("p",[s._v("本质上是启动了一个“无服务“的nginx实例，禁用了daemon等大多数指令，也没有配置监听端口，只是在worker进程里用定时器让lua代码在Nginx里执行。")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("-e")]),s._v("参数可以在命令行里直接执行lua代码")]),s._v(" "),n("p",[n("code",[s._v("./resty -e \"print('hello world')\"")])]),s._v(" "),n("div",{staticClass:"language-hello.lua line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/opt/openresty/bin/resty\n\nlocal n = #arg\nprint("args count = ", n)\nfor i = 1, n do\n    print("arg ", i, ": ", arg[i])')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);